# Tauri Updater Troubleshooting

## Issue: `latest.json` Not Found (404)

### Problem
When checking for updates, you get:
```
https://github.com/TestSpectra/testspectra/releases/download/v0.1.26/latest.json
404 Not Found
```

### Root Cause
The `latest.json` file is only generated by `tauri-action` when:
1. The updater plugin is configured in `src-tauri/tauri.conf.json`
2. A public key is set in the updater config
3. The release is built **after** the updater config is in place

### Solution 1: Create a New Release (Recommended)

The easiest fix is to create a new release with the updater properly configured:

```bash
# 1. Ensure updater is configured in src-tauri/tauri.conf.json
# (Already done - check that pubkey is set)

# 2. Bump version
# Update: package.json, src-tauri/tauri.conf.json, backend/Cargo.toml

# 3. Create new release
git add .
git commit -m "chore: bump version to 0.1.27"
git tag v0.1.27
git push origin main
git push origin v0.1.27

# 4. GitHub Actions will build and create latest.json automatically
```

### Solution 2: Use `/latest` Endpoint (Already Configured)

Your config already uses the `/latest` endpoint:
```json
{
  "plugins": {
    "updater": {
      "endpoints": [
        "https://github.com/TestSpectra/testspectra/releases/latest/download/latest.json"
      ]
    }
  }
}
```

This means the updater always checks the latest release, not a specific version. Perfect!

## Verification

After adding `latest.json`, verify it's accessible:

```bash
curl -I https://github.com/TestSpectra/testspectra/releases/download/v0.1.26/latest.json
# Should return: HTTP/2 200

curl https://github.com/TestSpectra/testspectra/releases/download/v0.1.26/latest.json
# Should return the JSON content
```

## Why Signatures Matter

Signatures ensure the downloaded update hasn't been tampered with:

1. **Build time**: Tauri signs the binary with your private key
2. **Update time**: Tauri verifies the signature with your public key (in config)
3. **If signature doesn't match**: Update is rejected

Without signatures in `latest.json`, the updater may fail or skip verification.

## How tauri-action Generates latest.json

The `tauri-action` in your GitHub workflow automatically:

1. **Builds** the app for all platforms
2. **Signs** each binary with your private key (creates `.sig` files)
3. **Generates** `latest.json` with:
   - Version information
   - Download URLs for each platform
   - Signatures for verification
4. **Uploads** everything to the GitHub release

This happens automatically when:
- ✅ Updater is configured in `tauri.conf.json`
- ✅ Public key is set in the config
- ✅ `TAURI_SIGNING_PRIVATE_KEY` is in GitHub Secrets
- ✅ `uploadUpdaterJson: true` in workflow (default)

## Why v0.1.26 Doesn't Have latest.json

v0.1.26 was released **before** the updater configuration was added. At build time:
- ❌ No updater config in `tauri.conf.json`
- ❌ No public key set
- ❌ No signing key in GitHub Secrets

Result: No `latest.json` or `.sig` files were generated.

## Future Releases

Once the updater config is in place (which it is now), all future releases will automatically include `latest.json` with proper signatures. You won't need to do anything manually.

## Common Errors

### "Failed to verify signature"
- Public key in config doesn't match private key used for signing
- Signature in `latest.json` is incorrect or missing
- Solution: Regenerate keys and rebuild

### "Update available but download fails"
- URL in `latest.json` is incorrect
- Asset file doesn't exist in release
- Solution: Check asset names match exactly

### "No update detected"
- `latest.json` not found (404)
- Version in JSON is same or lower than current
- Endpoint URL is wrong
- Solution: Check endpoint and version numbers

## Testing Updates Locally

To test without publishing:

1. Run a local HTTP server with `latest.json`
2. Update endpoint in config to point to localhost
3. Test the update flow

```bash
# Serve latest.json locally
python3 -m http.server 8000

# Update tauri.conf.json temporarily
"endpoints": ["http://localhost:8000/latest.json"]

# Run app and test update
pnpm tauri:dev
```

## Related Documentation

- Setup: `docs/UPDATER_SETUP_GUIDE.md`
- Release process: `docs/RELEASE_CHECKLIST.md`
- Technical details: `docs/TAURI_UPDATER.md`
